name: Main Branch CI (Frontend Test & Build)

on:
  push:
    branches: [ "main" ]
    # 프론트엔드 코드가 변경되었을 때만 실행
    paths:
      - 'MM-FE/matchmeal-project/**'
  pull_request:
    branches: [ "main" ]
    paths:
      - 'MM-FE/matchmeal-project/**'

permissions:
  contents: read

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    # ★ [핵심 설정] 터미널의 기본 위치를 프론트엔드 폴더로 고정합니다.
    defaults:
      run:
        working-directory: ./MM-FE/matchmeal-project

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22' # LTS 버전 사용 권장 (24는 최신이라 불안정할 수 있음)
          cache: 'npm'
          # 캐시 경로를 명확하게 지정 (working-directory 영향 안 받음)
          cache-dependency-path: './MM-FE/matchmeal-project/package-lock.json'

      - name: Install Dependencies
        # package-lock.json 기준으로 엄격하게 설치
        run: npm ci

      - name: Lint Check (Syntax & Style)
        # 코드 스타일 및 문법 오류 검사
        run: npm run lint

      - name: Type Check (TypeScript)
        # 타입스크립트 컴파일 오류 검사
        run: npm run type-check

      # (선택 사항) 유닛 테스트가 있다면 주석 해제하세요
      # - name: Run Unit Tests
      #   run: npm run test:unit

      - name: Build Project
        # 최종적으로 빌드가 성공하는지 검증 (dist 폴더 생성)
        # 여기서 에러가 나면 main 브랜치에 문제가 있는 것이므로 실패 처리됨
        run: npm run build